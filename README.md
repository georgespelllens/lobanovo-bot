# üê∫ –ü—Ä–∏—ë–º–Ω–∞—è –õ–æ–±–∞–Ω–æ–≤–∞ ‚Äî –ò–ò-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –ø–æ –ª–∏—á–Ω–æ–º—É –±—Ä–µ–Ω–¥—É

Telegram-–±–æ—Ç + –≤–µ–±-–¥–∞—à–±–æ—Ä–¥ ‚Äî –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤—É –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–∞ –õ–æ–±–∞–Ω–æ–≤–∞.

**–ë–æ—Ç:** [@lobanov_mentor_bot](https://t.me/lobanov_mentor_bot)
**–í–µ–±:** [lobanovo-bot-production.up.railway.app](https://lobanovo-bot-production.up.railway.app)

---

## –ß—Ç–æ —É–º–µ–µ—Ç

### üí¨ RAG Q&A
–û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –ª–∏—á–Ω–æ–º –±—Ä–µ–Ω–¥–µ, –∫–∞—Ä—å–µ—Ä–µ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–µ, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ 2600+ –ø–æ—Å—Ç–æ–≤ –õ–æ–±–∞–Ω–æ–≤–∞. –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ (cosine similarity —á–µ—Ä–µ–∑ numpy) –ø–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º Gemini. LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã –≤ —Å—Ç–∏–ª–µ –õ–æ–±–∞–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ Claude Sonnet (OpenRouter) —Å fallback –Ω–∞ Gemini Flash. –ë–µ–∑ –ª–∏–º–∏—Ç–æ–≤ ‚Äî –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ.

### üìù –ê—É–¥–∏—Ç –ø–æ—Å—Ç–æ–≤
–†–∞–∑–±–∏—Ä–∞–µ—Ç —Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ 6 –∫—Ä–∏—Ç–µ—Ä–∏—è–º –õ–æ–±–∞–Ω–æ–≤–∞: –º–µ—Ç–∞-—Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞, –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å, –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã, CTA. –ú–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.

### üìã –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è + –ø—Ä–æ–≥—Ä–µ—Å—Å
–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –Ω–µ–¥–µ–ª—é —Å —Ç—Ä–µ–∫–∏–Ω–≥–æ–º XP –∏ —É—Ä–æ–≤–Ω—è–º–∏: üê± –ö–æ—Ç—ë–Ω–æ–∫ (0‚Äì99 XP) ‚Üí üê∫ –í–æ–ª—á–æ–Ω–æ–∫ (100‚Äì299 XP) ‚Üí üê∫üî• –í–æ–ª–∫ (300+ XP). –ó–∞–¥–∞–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 10:00 –ú–°–ö. –°–¥–∞—á–∞ –∑–∞–¥–∞–Ω–∏–π —Å —è–≤–Ω—ã–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### üé§ –ü—Ä—è–º–∞—è –ª–∏–Ω–∏—è —Å –ö–æ—Å—Ç–µ–π
–ö–∏–ª–ª–µ—Ä-—Ñ–∏—á–∞: –∑–∞ 1000‚ÇΩ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å (—Ç–µ–∫—Å—Ç–æ–º –∏–ª–∏ –≥–æ–ª–æ—Å–æ–≤—ã–º), –õ–æ–±–∞–Ω–æ–≤ –æ—Ç–≤–µ—á–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤—ã–º –Ω–∞ 5‚Äì10 –º–∏–Ω—É—Ç. –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –æ–ø–ª–∞—Ç–∞ ‚Üí –≤–æ–ø—Ä–æ—Å ‚Üí –∫–∞—Ä—Ç–æ—á–∫–∞ –∞–¥–º–∏–Ω—É ‚Üí –≥–æ–ª–æ—Å–æ–≤–æ–π –æ—Ç–≤–µ—Ç ‚Üí –¥–æ—Å—Ç–∞–≤–∫–∞. –õ—É—á—à–∏–µ –æ—Ç–≤–µ—Ç—ã (—Å —Å–æ–≥–ª–∞—Å–∏—è) –ø–æ–ø–∞–¥–∞—é—Ç –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π. –°–æ—Å—Ç–æ—è–Ω–∏–µ DL —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î (–≤—ã–∂–∏–≤–∞–µ—Ç —Ä–µ—Å—Ç–∞—Ä—Ç—ã).

### üîî –≠—Å–∫–∞–ª–∞—Ü–∏—è –∫ –õ–æ–±–∞–Ω–æ–≤—É
–ë–æ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç, –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –∂–∏–≤–æ–π —á–µ–ª–æ–≤–µ–∫ (–ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å, 3x üëé, —Å–ª–æ–∂–Ω—ã–π –∫–µ–π—Å) –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ü—Ä—è–º—É—é –ª–∏–Ω–∏—é –∏–ª–∏ –ø–æ–ª–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é.

### üåê –í–µ–±-–¥–∞—à–±–æ—Ä–¥
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** –ø—Ä–æ–≥—Ä–µ—Å—Å, –∏—Å—Ç–æ—Ä–∏—è, –∑–∞–¥–∞–Ω–∏—è, –∞—É–¥–∏—Ç—ã
- **–ê–¥–º–∏–Ω:** —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —ç—Å–∫–∞–ª–∞—Ü–∏–∏, –ü—Ä—è–º–∞—è –ª–∏–Ω–∏—è, –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π, —Ñ–∏–Ω–∞–Ω—Å—ã

---

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `/start` | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ (5 –≤–æ–ø—Ä–æ—Å–æ–≤) |
| `/help` | –°–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π |
| `/ask` | –†–µ–∂–∏–º Q&A |
| `/audit` | –†–µ–∂–∏–º –∞—É–¥–∏—Ç–∞ –ø–æ—Å—Ç–æ–≤ |
| `/tasks` | –ó–∞–¥–∞–Ω–∏—è –Ω–∞ –Ω–µ–¥–µ–ª—é |
| `/progress` | –£—Ä–æ–≤–µ–Ω—å, XP, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| `/ask_kostya` | üé§ –ü—Ä—è–º–∞—è –ª–∏–Ω–∏—è (1000‚ÇΩ) |
| `/consult` | –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é |
| `/plan` | –¢–∞—Ä–∏—Ñ –∏ –ª–∏–º–∏—Ç—ã |
| `/feedback` | –û—Ç–∑—ã–≤ –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ |

**–ê–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã:** `/admin_stats`, `/admin_escalations`, `/admin_top_questions`, `/admin_users`, `/admin_broadcast`, `/admin_add_knowledge`

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|------------|
| –Ø–∑—ã–∫ | Python 3.11+ |
| –ë–æ—Ç | python-telegram-bot 21.x |
| –í–µ–± | FastAPI + Jinja2 + HTMX |
| –ë–î | PostgreSQL (pgvector –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| ORM | SQLAlchemy 2.0 + asyncpg |
| –ú–∏–≥—Ä–∞—Ü–∏–∏ | Alembic |
| LLM | OpenRouter: Claude Sonnet (chat) + Gemini Flash (fast) + Gemini Embedding (vectors) |
| STT | OpenAI Whisper |
| –î–µ–ø–ª–æ–π | Railway.com |

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
lobanovo-bot/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.py                     # FastAPI + Telegram webhook
‚îÇ   ‚îú‚îÄ‚îÄ config.py                   # Pydantic Settings + —Ç–∞—Ä–∏—Ñ—ã + –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.py            # /start, –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ 5 –≤–æ–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ qa.py               # RAG Q&A —Å –æ—Ü–µ–Ω–∫–∞–º–∏ üëç/üëé
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ audit.py            # –ê—É–¥–∏—Ç –ø–æ—Å—Ç–æ–≤ –ø–æ 6 –∫—Ä–∏—Ç–µ—Ä–∏—è–º
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks.py            # –ó–∞–¥–∞–Ω–∏—è, /progress
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.py            # –ê–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment.py          # –¢–∞—Ä–∏—Ñ—ã, –æ–ø–ª–∞—Ç–∞ –ø–æ–¥–ø–∏—Å–æ–∫
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ direct_line.py      # üé§ –ü—Ä—è–º–∞—è –ª–∏–Ω–∏—è —Å –ö–æ—Å—Ç–µ–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ voice.py            # –ì–æ–ª–æ—Å–æ–≤—ã–µ ‚Üí Whisper ‚Üí —Ç–µ–∫—Å—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ callbacks.py            # –†–æ—É—Ç–∏–Ω–≥ inline-–∫–Ω–æ–ø–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware.py           # –¢—Ä–µ–∫–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ scheduler.py            # Cron: –∑–∞–¥–∞–Ω–∏—è –ü–ù, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –í–°, –¥–µ–¥–ª–∞–π–Ω—ã
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ llm_service.py          # OpenRouter API + retry + fallback
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rag_service.py          # –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ + —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stt_service.py          # Whisper —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task_service.py         # XP, —É—Ä–æ–≤–Ω–∏, –∑–∞–¥–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ escalation_service.py   # –≠—Å–∫–∞–ª–∞—Ü–∏–∏ –∫ –õ–æ–±–∞–Ω–æ–≤—É
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ direct_line_service.py  # –ü—Ä—è–º–∞—è –ª–∏–Ω–∏—è: –æ—á–µ—Ä–µ–¥—å, –∫–∞—Ä—Ç–æ—á–∫–∏, KB
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ subscription_service.py # –¢–∞—Ä–∏—Ñ—ã, –ª–∏–º–∏—Ç—ã
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py               # 11 SQLAlchemy –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ connection.py           # Async session management
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repository.py           # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ web/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/                 # auth, dashboard, admin
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates/              # Jinja2 (base, dashboard, admin, login)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ static/css/             # –¢—ë–º–Ω–∞—è —Ç–µ–º–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ utils/                      # –õ–æ–≥–≥–µ—Ä, –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ load_knowledge_base.py      # –ü–∞—Ä—Å–∏–Ω–≥ MD/HTML —ç–∫—Å–ø–æ—Ä—Ç–æ–≤ –∫–∞–Ω–∞–ª–æ–≤ + –ø—Ä–µ–¥—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ filter_quality.py           # LLM-–æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ—Å—Ç–æ–≤ (0.0‚Äì1.0)
‚îÇ   ‚îú‚îÄ‚îÄ generate_embeddings.py      # –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ + –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è LLM
‚îÇ   ‚îî‚îÄ‚îÄ seed_tasks.py               # 21 —à–∞–±–ª–æ–Ω –∑–∞–¥–∞–Ω–∏–π (7 –Ω–∞ —É—Ä–æ–≤–µ–Ω—å)
‚îÇ
‚îú‚îÄ‚îÄ migrations/                     # Alembic
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ Procfile                        # Railway: web + release
‚îî‚îÄ‚îÄ .env.example
```

---

## –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

```bash
# 1. Dry-run ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–µ–∑ –∑–∞–ø–∏—Å–∏ –≤ –ë–î
python scripts/load_knowledge_base.py --all --dry-run

# 2. –ó–∞–≥—Ä—É–∑–∫–∞ —Å –ø—Ä–µ–¥—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π (–º–∏–Ω. 200 —Å–∏–º–≤–æ–ª–æ–≤, –æ—Ç—Å–µ–≤ –º—É—Å–æ—Ä–∞)
python scripts/load_knowledge_base.py --all

# 3. LLM-–æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ (Gemini Flash, ~$0.5‚Äì1)
python scripts/filter_quality.py

# 4. –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
python scripts/generate_embeddings.py

# 5. –®–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞–Ω–∏–π
python scripts/seed_tasks.py
```

---

## –ó–∞–ø—É—Å–∫

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
# –ó–∞–ø–æ–ª–Ω–∏: TELEGRAM_BOT_TOKEN, DATABASE_URL, OPENROUTER_API_KEY,
#          ADMIN_CHAT_ID, ADMIN_USER_IDS
```

### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
# –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3 -m venv venv && source venv/bin/activate

# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# PostgreSQL (Docker)
docker run -d --name lobanov-pg \
  -e POSTGRES_PASSWORD=password -e POSTGRES_DB=lobanov_bot \
  -p 5432:5432 postgres:16

# –ú–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –ó–∞–ø—É—Å–∫
python -m uvicorn src.main:app --reload --port 8000
```

### –î–µ–ø–ª–æ–π –Ω–∞ Railway

1. New Project ‚Üí Deploy from GitHub ‚Üí —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–æ–µ–∫—Ç–∞
2. Add ‚Üí Database ‚Üí PostgreSQL
3. –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env` –≤ Variables
4. **–í–∞–∂–Ω–æ:** `APP_URL` –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –¥–æ–º–µ–Ω–æ–º Railway
5. –°–±–æ—Ä–∫–∞ –∏ –¥–µ–ø–ª–æ–π ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ: `railway.toml` –∏ `nixpacks.toml`. –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ pre-deploy (`alembic upgrade head`)

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** pgvector –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ Railway PostgreSQL. –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –Ω–µ–≥–æ ‚Äî embedding –∫–æ–ª–æ–Ω–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSONB, –∞ –ø–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Python-side cosine similarity (numpy).

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Telegram User ‚îÄ‚îÄ‚Üí Webhook (/webhook)
                    ‚îÇ
                    ‚îú‚îÄ‚îÄ Command Router ‚îÄ‚îÄ‚Üí /start, /help, /audit, /ask_kostya...
                    ‚îú‚îÄ‚îÄ Message Router ‚îÄ‚îÄ‚Üí Q&A / Audit / Task Review / Direct Line
                    ‚îú‚îÄ‚îÄ Voice Handler  ‚îÄ‚îÄ‚Üí Whisper STT ‚Üí Text ‚Üí Router
                    ‚îî‚îÄ‚îÄ Callback Router ‚îÄ‚îÄ‚Üí üëç/üëé, –æ–ø–ª–∞—Ç–∞, –æ–Ω–±–æ—Ä–¥–∏–Ω–≥, –∞–¥–º–∏–Ω
                    
Q&A Pipeline:
  Question ‚Üí Embedding (Gemini) ‚Üí Cosine similarity (top-5) ‚Üí System prompt + context ‚Üí Claude Sonnet ‚Üí Response

Audit Pipeline:
  Post text ‚Üí 6 criteria prompt ‚Üí Claude Sonnet ‚Üí Structured review

Direct Line Pipeline:
  /ask_kostya ‚Üí Payment ‚Üí Question (text/voice) ‚Üí Admin card ‚Üí Lobanov voice ‚Üí Deliver ‚Üí KB enrichment
```

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (11 —Ç–∞–±–ª–∏—Ü)

- `users` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –æ–Ω–±–æ—Ä–¥–∏–Ω–≥, XP, –ø–æ–¥–ø–∏—Å–∫–∏
- `knowledge_base` ‚Äî 2600+ –ø–æ—Å—Ç–æ–≤ —Å LLM-—Å–∫–æ—Ä–∏–Ω–≥–æ–º + —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
- `conversations` ‚Äî —Å–µ—Å—Å–∏–∏ –æ–±—â–µ–Ω–∏—è (Q&A, –∞—É–¥–∏—Ç, –æ–Ω–±–æ—Ä–¥–∏–Ω–≥)
- `messages` ‚Äî –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è + –æ—Ü–µ–Ω–∫–∏ + —Å—Ç–æ–∏–º–æ—Å—Ç—å API
- `task_templates` ‚Äî 21 —à–∞–±–ª–æ–Ω –∑–∞–¥–∞–Ω–∏–π –ø–æ —É—Ä–æ–≤–Ω—è–º
- `user_tasks` ‚Äî –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è + —Ä–µ–≤—å—é
- `escalations` ‚Äî —ç—Å–∫–∞–ª–∞—Ü–∏–∏ –∫ –õ–æ–±–∞–Ω–æ–≤—É
- `subscriptions` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –ø–æ–¥–ø–∏—Å–æ–∫
- `system_prompts` ‚Äî –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤
- `direct_questions` ‚Äî –ü—Ä—è–º–∞—è –ª–∏–Ω–∏—è (–ø–æ–ª–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª)
- `feedback` ‚Äî –æ—Ç–∑—ã–≤—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

–ë–æ—Ç –ø—É–±–ª–∏—á–Ω—ã–π. –õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É:
‚û°Ô∏è [t.me/lobanov_mentor_bot](https://t.me/lobanov_mentor_bot)

–ù–∞–ø–∏—à–∏ `/start` ‚Äî –±–æ—Ç –ø—Ä–æ–≤–µ–¥—ë—Ç –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –∏ –Ω–∞—á–Ω—ë—Ç —Ä–∞–±–æ—Ç—É.

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

Proprietary. ¬© 2026 –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω –õ–æ–±–∞–Ω–æ–≤.
