# üê∫ –ü—Ä–∏—ë–º–Ω–∞—è –õ–æ–±–∞–Ω–æ–≤–∞ ‚Äî –ò–ò-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –ø–æ –ª–∏—á–Ω–æ–º—É –±—Ä–µ–Ω–¥—É

Telegram-–±–æ—Ç + –≤–µ–±-–¥–∞—à–±–æ—Ä–¥ ‚Äî –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤—É –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–∞ –õ–æ–±–∞–Ω–æ–≤–∞.

**–ë–æ—Ç:** [@lobanov_mentor_bot](https://t.me/lobanov_mentor_bot)
**–í–µ–±:** [lobanovo-bot-production.up.railway.app](https://lobanovo-bot-production.up.railway.app)

---

## –ß—Ç–æ —É–º–µ–µ—Ç

### üí¨ RAG Q&A
–û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –ª–∏—á–Ω–æ–º –±—Ä–µ–Ω–¥–µ, –∫–∞—Ä—å–µ—Ä–µ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–µ, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ 3000+ –ø–æ—Å—Ç–æ–≤ –õ–æ–±–∞–Ω–æ–≤–∞. –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ (cosine similarity —á–µ—Ä–µ–∑ numpy) –ø–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º. LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã –≤ —Å—Ç–∏–ª–µ –õ–æ–±–∞–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ xAI Grok —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –º–æ–¥–µ–ª—å.

### üìù –ê—É–¥–∏—Ç –ø–æ—Å—Ç–æ–≤
–†–∞–∑–±–∏—Ä–∞–µ—Ç —Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ 6 –∫—Ä–∏—Ç–µ—Ä–∏—è–º –õ–æ–±–∞–Ω–æ–≤–∞: –º–µ—Ç–∞-—Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞, –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å, –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã, CTA. –ú–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.

### üìã –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è + –ø—Ä–æ–≥—Ä–µ—Å—Å
–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –Ω–µ–¥–µ–ª—é —Å —Ç—Ä–µ–∫–∏–Ω–≥–æ–º XP –∏ —É—Ä–æ–≤–Ω—è–º–∏: üê± –ö–æ—Ç—ë–Ω–æ–∫ (0‚Äì99 XP) ‚Üí üê∫ –í–æ–ª—á–æ–Ω–æ–∫ (100‚Äì299 XP) ‚Üí üê∫üî• –í–æ–ª–∫ (300+ XP). –ó–∞–¥–∞–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 10:00 –ú–°–ö. –°–¥–∞—á–∞ –∑–∞–¥–∞–Ω–∏–π —Å —è–≤–Ω—ã–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### üé§ –ü—Ä—è–º–∞—è –ª–∏–Ω–∏—è —Å –ö–æ—Å—Ç–µ–π
–ö–∏–ª–ª–µ—Ä-—Ñ–∏—á–∞: –∑–∞ 1000‚ÇΩ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å (—Ç–µ–∫—Å—Ç–æ–º –∏–ª–∏ –≥–æ–ª–æ—Å–æ–≤—ã–º), –õ–æ–±–∞–Ω–æ–≤ –æ—Ç–≤–µ—á–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤—ã–º –Ω–∞ 5‚Äì10 –º–∏–Ω—É—Ç. –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –æ–ø–ª–∞—Ç–∞ ‚Üí –≤–æ–ø—Ä–æ—Å ‚Üí –∫–∞—Ä—Ç–æ—á–∫–∞ –∞–¥–º–∏–Ω—É ‚Üí –≥–æ–ª–æ—Å–æ–≤–æ–π –æ—Ç–≤–µ—Ç ‚Üí –¥–æ—Å—Ç–∞–≤–∫–∞. –õ—É—á—à–∏–µ –æ—Ç–≤–µ—Ç—ã (—Å —Å–æ–≥–ª–∞—Å–∏—è) –ø–æ–ø–∞–¥–∞—é—Ç –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π. –°–æ—Å—Ç–æ—è–Ω–∏–µ DL —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î (–≤—ã–∂–∏–≤–∞–µ—Ç —Ä–µ—Å—Ç–∞—Ä—Ç—ã).

### üîî –≠—Å–∫–∞–ª–∞—Ü–∏—è –∫ –õ–æ–±–∞–Ω–æ–≤—É
–ë–æ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç, –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –∂–∏–≤–æ–π —á–µ–ª–æ–≤–µ–∫ (–ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å, 3x üëé, —Å–ª–æ–∂–Ω—ã–π –∫–µ–π—Å) –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ü—Ä—è–º—É—é –ª–∏–Ω–∏—é –∏–ª–∏ –ø–æ–ª–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é.

### üíé –ü–æ–¥–ø–∏—Å–∫–∏
Free (0‚ÇΩ) ‚Üí Pro (990‚ÇΩ/–º–µ—Å) ‚Üí Premium (4990‚ÇΩ/–º–µ—Å) —Å —Ä–∞–∑–Ω—ã–º–∏ –ª–∏–º–∏—Ç–∞–º–∏ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –∞—É–¥–∏—Ç—ã –∏ –¥–æ—Å—Ç—É–ø –∫ –¥–∞—à–±–æ—Ä–¥—É.

### üåê –í–µ–±-–¥–∞—à–±–æ—Ä–¥
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** –ø—Ä–æ–≥—Ä–µ—Å—Å, –∏—Å—Ç–æ—Ä–∏—è, –∑–∞–¥–∞–Ω–∏—è, –∞—É–¥–∏—Ç—ã
- **–ê–¥–º–∏–Ω:** —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —ç—Å–∫–∞–ª–∞—Ü–∏–∏, –ü—Ä—è–º–∞—è –ª–∏–Ω–∏—è, –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π, —Ñ–∏–Ω–∞–Ω—Å—ã

---

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `/start` | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ (5 –≤–æ–ø—Ä–æ—Å–æ–≤) |
| `/help` | –°–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π |
| `/ask` | –†–µ–∂–∏–º Q&A |
| `/audit` | –†–µ–∂–∏–º –∞—É–¥–∏—Ç–∞ –ø–æ—Å—Ç–æ–≤ |
| `/tasks` | –ó–∞–¥–∞–Ω–∏—è –Ω–∞ –Ω–µ–¥–µ–ª—é |
| `/progress` | –£—Ä–æ–≤–µ–Ω—å, XP, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| `/ask_kostya` | üé§ –ü—Ä—è–º–∞—è –ª–∏–Ω–∏—è (1000‚ÇΩ) |
| `/consult` | –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é |
| `/plan` | –¢–∞—Ä–∏—Ñ –∏ –ª–∏–º–∏—Ç—ã |
| `/feedback` | –û—Ç–∑—ã–≤ –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ |

**–ê–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã:** `/admin_stats`, `/admin_escalations`, `/admin_top_questions`, `/admin_users`, `/admin_broadcast`, `/admin_add_knowledge`

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|------------|
| –Ø–∑—ã–∫ | Python 3.11+ |
| –ë–æ—Ç | python-telegram-bot 21.x |
| –í–µ–± | FastAPI + Jinja2 + HTMX |
| –ë–î | PostgreSQL (pgvector –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| ORM | SQLAlchemy 2.0 + asyncpg |
| –ú–∏–≥—Ä–∞—Ü–∏–∏ | Alembic |
| LLM | xAI Grok (chat) + OpenRouter (embeddings: google/gemini-embedding-001) |
| STT | OpenAI Whisper |
| –î–µ–ø–ª–æ–π | Railway.com |

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
lobanovo-bot/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.py                     # FastAPI + Telegram webhook
‚îÇ   ‚îú‚îÄ‚îÄ config.py                   # Pydantic Settings + —Ç–∞—Ä–∏—Ñ—ã + –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.py            # /start, –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ 5 –≤–æ–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ qa.py               # RAG Q&A —Å –æ—Ü–µ–Ω–∫–∞–º–∏ üëç/üëé
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ audit.py            # –ê—É–¥–∏—Ç –ø–æ—Å—Ç–æ–≤ –ø–æ 6 –∫—Ä–∏—Ç–µ—Ä–∏—è–º
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks.py            # –ó–∞–¥–∞–Ω–∏—è, /progress
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.py            # –ê–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment.py          # –¢–∞—Ä–∏—Ñ—ã, –æ–ø–ª–∞—Ç–∞ –ø–æ–¥–ø–∏—Å–æ–∫
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ direct_line.py      # üé§ –ü—Ä—è–º–∞—è –ª–∏–Ω–∏—è —Å –ö–æ—Å—Ç–µ–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ voice.py            # –ì–æ–ª–æ—Å–æ–≤—ã–µ ‚Üí Whisper ‚Üí —Ç–µ–∫—Å—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ callbacks.py            # –†–æ—É—Ç–∏–Ω–≥ inline-–∫–Ω–æ–ø–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware.py           # –¢—Ä–µ–∫–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ scheduler.py            # Cron: –∑–∞–¥–∞–Ω–∏—è –ü–ù, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –í–°, –¥–µ–¥–ª–∞–π–Ω—ã
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ llm_service.py          # xAI Grok API + retry + fallback
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rag_service.py          # –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ + —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stt_service.py          # Whisper —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task_service.py         # XP, —É—Ä–æ–≤–Ω–∏, –∑–∞–¥–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ escalation_service.py   # –≠—Å–∫–∞–ª–∞—Ü–∏–∏ –∫ –õ–æ–±–∞–Ω–æ–≤—É
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ direct_line_service.py  # –ü—Ä—è–º–∞—è –ª–∏–Ω–∏—è: –æ—á–µ—Ä–µ–¥—å, –∫–∞—Ä—Ç–æ—á–∫–∏, KB
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ subscription_service.py # –¢–∞—Ä–∏—Ñ—ã, –ª–∏–º–∏—Ç—ã
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py               # 10 SQLAlchemy –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ connection.py           # Async session management
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repository.py           # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ web/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/                 # auth, dashboard, admin
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates/              # Jinja2 (base, dashboard, admin, login)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ static/css/             # –¢—ë–º–Ω–∞—è —Ç–µ–º–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ utils/                      # –õ–æ–≥–≥–µ—Ä, –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ load_knowledge_base.py      # –ü–∞—Ä—Å–∏–Ω–≥ HTML/MD —ç–∫—Å–ø–æ—Ä—Ç–æ–≤ –∫–∞–Ω–∞–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ generate_embeddings.py      # –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ + –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è LLM
‚îÇ   ‚îî‚îÄ‚îÄ seed_tasks.py               # 21 —à–∞–±–ª–æ–Ω –∑–∞–¥–∞–Ω–∏–π (7 –Ω–∞ —É—Ä–æ–≤–µ–Ω—å)
‚îÇ
‚îú‚îÄ‚îÄ migrations/                     # Alembic
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ Procfile                        # Railway: web + release
‚îî‚îÄ‚îÄ .env.example
```

---

## –ó–∞–ø—É—Å–∫

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
# –ó–∞–ø–æ–ª–Ω–∏: TELEGRAM_BOT_TOKEN, DATABASE_URL, XAI_API_KEY, OPENROUTER_API_KEY,
#          OPENAI_API_KEY (Whisper), ADMIN_CHAT_ID, ADMIN_USER_IDS
```

### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
# –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3 -m venv venv && source venv/bin/activate

# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# PostgreSQL —Å pgvector (Docker)
docker run -d --name lobanov-pg \
  -e POSTGRES_PASSWORD=password -e POSTGRES_DB=lobanov_bot \
  -p 5432:5432 pgvector/pgvector:pg16

# –ú–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –ó–∞–ø—É—Å–∫
python -m uvicorn src.main:app --reload --port 8000
```

### –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

```bash
# –ü–æ—Å—Ç—ã –∏–∑ —ç–∫—Å–ø–æ—Ä—Ç–æ–≤ –∫–∞–Ω–∞–ª–æ–≤ (–ø–æ–ª–æ–∂–∏—Ç—å —Ñ–∞–π–ª—ã –≤ data/)
python scripts/load_knowledge_base.py --all

# –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ + –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è
python scripts/generate_embeddings.py

# –ü–µ—Ä–µ—Å—á—ë—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (–ø–æ—Å–ª–µ —Å–º–µ–Ω—ã –º–æ–¥–µ–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–∞ Gemini)
python scripts/generate_embeddings.py --force --only-embeddings

# –ß–µ—Ä–µ–∑ Railway (–µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –ø—Ä–∏–≤—è–∑–∞–Ω: railway link)
railway run python scripts/generate_embeddings.py --force --only-embeddings

# –ß–µ—Ä–µ–∑ API (–ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è ‚Äî —Ç—Ä–µ–±—É–µ—Ç SECRET_KEY –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ)
curl -X POST https://lobanovo-bot-production.up.railway.app/admin/api/regenerate-embeddings \
  -H "X-Admin-Token: YOUR_SECRET_KEY"

# –®–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞–Ω–∏–π
python scripts/seed_tasks.py
```

### –î–µ–ø–ª–æ–π –Ω–∞ Railway

1. New Project ‚Üí Deploy from GitHub ‚Üí `georgespelllens/lobanovo-bot`
2. Add ‚Üí Database ‚Üí PostgreSQL
3. –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env` –≤ Variables
4. **–í–∞–∂–Ω–æ:** `APP_URL` –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –¥–æ–º–µ–Ω–æ–º, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º Railway (–Ω–∞–ø—Ä–∏–º–µ—Ä `https://lobanovo-bot-production.up.railway.app`)
5. –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Alembic (`alembic upgrade head` –≤ release phase)

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** pgvector –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ Railway PostgreSQL. –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –Ω–µ–≥–æ ‚Äî embedding –∫–æ–ª–æ–Ω–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSONB, –∞ –ø–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Python-side cosine similarity (numpy).

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Telegram User ‚îÄ‚îÄ‚Üí Webhook (/webhook)
                    ‚îÇ
                    ‚îú‚îÄ‚îÄ Command Router ‚îÄ‚îÄ‚Üí /start, /help, /audit, /ask_kostya...
                    ‚îú‚îÄ‚îÄ Message Router ‚îÄ‚îÄ‚Üí Q&A / Audit / Task Review / Direct Line
                    ‚îú‚îÄ‚îÄ Voice Handler  ‚îÄ‚îÄ‚Üí Whisper STT ‚Üí Text ‚Üí Router
                    ‚îî‚îÄ‚îÄ Callback Router ‚îÄ‚îÄ‚Üí üëç/üëé, –æ–ø–ª–∞—Ç–∞, –æ–Ω–±–æ—Ä–¥–∏–Ω–≥, –∞–¥–º–∏–Ω
                    
Q&A Pipeline:
  Question ‚Üí Embedding (Gemini) ‚Üí Cosine similarity search (top-5) ‚Üí System prompt + context ‚Üí xAI Grok ‚Üí Response

Audit Pipeline:
  Post text ‚Üí 6 criteria prompt ‚Üí xAI Grok ‚Üí Structured review

Direct Line Pipeline:
  /ask_kostya ‚Üí Payment ‚Üí Question (text/voice) ‚Üí Admin card ‚Üí Lobanov voice ‚Üí Deliver ‚Üí KB enrichment
```

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (11 —Ç–∞–±–ª–∏—Ü)

- `users` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –æ–Ω–±–æ—Ä–¥–∏–Ω–≥, XP, –ø–æ–¥–ø–∏—Å–∫–∏, –ª–∏–º–∏—Ç—ã
- `knowledge_base` ‚Äî 3000+ –ø–æ—Å—Ç–æ–≤ + —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (JSONB, pgvector –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `conversations` ‚Äî —Å–µ—Å—Å–∏–∏ –æ–±—â–µ–Ω–∏—è (Q&A, –∞—É–¥–∏—Ç, –æ–Ω–±–æ—Ä–¥–∏–Ω–≥)
- `messages` ‚Äî –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è + –æ—Ü–µ–Ω–∫–∏ + —Å—Ç–æ–∏–º–æ—Å—Ç—å API
- `task_templates` ‚Äî 21 —à–∞–±–ª–æ–Ω –∑–∞–¥–∞–Ω–∏–π –ø–æ —É—Ä–æ–≤–Ω—è–º
- `user_tasks` ‚Äî –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è + —Ä–µ–≤—å—é
- `escalations` ‚Äî —ç—Å–∫–∞–ª–∞—Ü–∏–∏ –∫ –õ–æ–±–∞–Ω–æ–≤—É
- `subscriptions` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –ø–æ–¥–ø–∏—Å–æ–∫
- `system_prompts` ‚Äî –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤
- `direct_questions` ‚Äî –ü—Ä—è–º–∞—è –ª–∏–Ω–∏—è (–ø–æ–ª–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª)
- `feedback` ‚Äî –æ—Ç–∑—ã–≤—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## –ê—É–¥–∏—Ç –∏ —Ñ–∏–∫—Å—ã (v1.1, 10 —Ñ–µ–≤—Ä–∞–ª—è 2026)

–ü–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ø–æ–ª–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ (6):**
- Callback parsing: `_` ‚Üí `:` —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å (—Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å `reason_off_topic_123`)
- –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ –ü—Ä—è–º—É—é –ª–∏–Ω–∏—é
- –ê–≤—Ç–æ–≤–æ–∑–≤—Ä–∞—Ç —Å—á–∏—Ç–∞–µ—Ç –¥–µ–¥–ª–∞–π–Ω –æ—Ç `created_at` (96—á), –∞ –Ω–µ –æ—Ç `deadline_at`
- –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤: `Vector(1536)` ‚Üí `Vector(768)` (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Gemini)
- RAG-–ø–æ–∏—Å–∫: Python-side cosine similarity –≤–º–µ—Å—Ç–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ `quality_score`
- –°–¥–∞—á–∞ –∑–∞–¥–∞–Ω–∏–π: —É–±—Ä–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–¥–∞—á–∞ –ø–æ –¥–ª–∏–Ω–µ —Ç–µ–∫—Å—Ç–∞, –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (8):**
- `@lru_cache` –Ω–∞ `get_settings()` ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- DL-—Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –ë–î –≤–º–µ—Å—Ç–æ `bot_data` (–≤—ã–∂–∏–≤–∞–µ—Ç —Ä–µ—Å—Ç–∞—Ä—Ç—ã)
- –û–¥–Ω–∞ DB-—Å–µ—Å—Å–∏—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (–≤–º–µ—Å—Ç–æ 3 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö)
- –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ `[DEBUG]` –ª–æ–≥–∏ –∏ `/debug/*` —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- LLM retry (2 –ø–æ–ø—ã—Ç–∫–∏) + fallback –º–æ–¥–µ–ª–∏ (`grok-4` ‚Üí `grok-3`)
- –°–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–ª–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º–∏ (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è)
- –ú–∏–≥—Ä–∞—Ü–∏—è —Å `datetime.utcnow()` –Ω–∞ `datetime.now(timezone.utc)`
- –£–±—Ä–∞–Ω `create_all` fallback ‚Äî —Ç–∞–±–ª–∏—Ü—ã —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Alembic

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

Proprietary. ¬© 2026 –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω –õ–æ–±–∞–Ω–æ–≤.
